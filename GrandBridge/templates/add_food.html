{% extends "layout.html" %}
{% block content %}
<style>
    /* Elderly-friendly and encouraging styling */
    .food-container {
        max-width: 1000px;
        margin: 20px auto;
        padding: 20px;
    }
    
    .food-header {
        background: linear-gradient(135deg, #fff3e0, #ffeb3b20, #e8f5e9);
        padding: 35px;
        border-radius: 20px;
        margin-bottom: 30px;
        text-align: center;
        box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        position: relative;
        overflow: hidden;
    }
    
    .food-header::before {
        content: 'ü•ó';
        position: absolute;
        font-size: 100px;
        opacity: 0.1;
        top: -20px;
        left: 20px;
        animation: float 6s ease-in-out infinite;
    }
    
    .food-header::after {
        content: 'üçé';
        position: absolute;
        font-size: 100px;
        opacity: 0.1;
        bottom: -20px;
        right: 20px;
        animation: float 6s ease-in-out infinite reverse;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-20px); }
    }
    
    .food-title {
        font-size: 2.8rem;
        color: #2c6f4f;
        margin: 0;
        font-weight: 600;
    }
    
    .food-subtitle {
        font-size: 1.5rem;
        color: #666;
        margin-top: 10px;
        font-style: italic;
    }
    
    /* Encouragement Messages */
    .encouragement-box {
        background: linear-gradient(135deg, #e8f5e9, #f0f9ff);
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 30px;
        border-left: 5px solid #4caf50;
    }
    
    .encouragement-title {
        font-size: 1.6rem;
        color: #2c6f4f;
        margin-bottom: 15px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .encouragement-text {
        font-size: 1.3rem;
        color: #555;
        line-height: 1.6;
    }
    
    .tips-list {
        list-style: none;
        padding: 0;
        margin: 15px 0;
    }
    
    .tips-list li {
        font-size: 1.25rem;
        margin: 10px 0;
        padding-left: 30px;
        position: relative;
        color: #444;
    }
    
    .tips-list li::before {
        content: '‚úì';
        position: absolute;
        left: 0;
        color: #4caf50;
        font-weight: bold;
        font-size: 1.4rem;
    }
    
    /* Form Styling */
    .form-section {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 3px 15px rgba(0,0,0,0.08);
        margin-bottom: 25px;
    }
    
    .section-title {
        font-size: 1.8rem;
        color: #2c6f4f;
        margin-bottom: 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .form-label {
        font-size: 1.3rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
        display: block;
    }
    
    .form-control {
        font-size: 1.25rem;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 10px;
        width: 100%;
        transition: all 0.3s;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #4caf50;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }
    
    /* Date Section */
    .date-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        margin-bottom: 20px;
    }
    
    .date-field {
        background: #f8fafb;
        padding: 20px;
        border-radius: 12px;
        border-left: 3px solid #4caf50;
    }
    
    /* Food Items */
    .food-item {
        background: linear-gradient(135deg, #fffef5, #fff);
        border: 2px solid #ffd54f;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        transition: all 0.3s;
        position: relative;
    }
    
    .food-item:hover {
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        transform: translateY(-2px);
    }
    
    .food-item-number {
        position: absolute;
        top: 15px;
        right: 15px;
        background: #ffd54f;
        color: #333;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
    }
    
    .food-fields {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr;
        gap: 20px;
        margin-bottom: 15px;
    }
    
    .field-group {
        display: flex;
        flex-direction: column;
    }
    
    .field-icon {
        font-size: 1.5rem;
        margin-right: 8px;
    }
    
    /* Buttons */
    .btn {
        font-size: 1.3rem;
        padding: 15px 30px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }
    
    .btn-add-food {
        background: linear-gradient(135deg, #66bb6a, #4caf50);
        color: white;
        margin-right: 15px;
    }
    
    .btn-add-food:hover {
        background: linear-gradient(135deg, #4caf50, #45a049);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }
    
    .btn-submit {
        background: linear-gradient(135deg, #4a7c59, #5a8d69);
        color: white;
        font-size: 1.5rem;
        padding: 18px 40px;
    }
    
    .btn-submit:hover {
        background: linear-gradient(135deg, #5a8d69, #4a7c59);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(74, 124, 89, 0.4);
    }
    
    .btn-remove {
        background: #ffebee;
        color: #d32f2f;
        padding: 10px 20px;
        font-size: 1.1rem;
    }
    
    .btn-remove:hover {
        background: #f44336;
        color: white;
    }
    
    /* Success/Error Messages */
    .alert {
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 25px;
        font-size: 1.3rem;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .alert-danger {
        background: #ffebee;
        border-left: 5px solid #f44336;
        color: #c62828;
    }
    
    .alert-success {
        background: #e8f5e9;
        border-left: 5px solid #4caf50;
        color: #2e7d32;
    }
    
    /* Helper Text */
    .helper-text {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        font-size: 1.2rem;
        color: #666;
        text-align: center;
    }
    
    /* Motivation quotes */
    .motivation-quote {
        background: linear-gradient(135deg, #fff3e0, #fff);
        padding: 20px;
        border-radius: 15px;
        margin: 30px 0;
        text-align: center;
        font-size: 1.4rem;
        color: #5d4037;
        font-style: italic;
        border: 2px solid #ffe082;
    }
    
    /* Action buttons section */
    .action-buttons {
        text-align: center;
        padding: 30px;
        background: #f8fafb;
        border-radius: 15px;
        margin-top: 30px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .date-section {
            grid-template-columns: 1fr;
        }
        
        .food-fields {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="food-container">
    <!-- Header -->
    <div class="food-header">
        <h2 class="food-title">üçõ Daily Food Journal</h2>
        <p class="food-subtitle">Track your meals and celebrate your healthy choices!</p>
    </div>

    <!-- Encouragement Section -->
    <div class="encouragement-box">
        <div class="encouragement-title">
            <span>üåü</span> Great job on tracking your nutrition!
        </div>
        <div class="encouragement-text">
            Recording your meals helps you:
            <ul class="tips-list">
                <li>Understand your eating patterns</li>
                <li>Make healthier food choices</li>
                <li>Maintain balanced nutrition</li>
                <li>Feel more in control of your health</li>
            </ul>
        </div>
    </div>

    {% if error %}
    <div class="alert alert-danger">
        <span style="font-size: 1.8rem;">‚ö†Ô∏è</span>
        {{ error }}
    </div>
    {% endif %}

    <form method="POST" id="food-form">
        {{ form.hidden_tag() }}
        
        <!-- Date Selection -->
        <div class="form-section">
            <h3 class="section-title">
                <span>üìÖ</span> When will you eat?
            </h3>
            <div class="date-section">
                <div class="date-field">
                    {{ form.start_date.label(class="form-label") }}
                    {{ form.start_date(class="form-control") }}
                    {% if form.start_date.errors %}
                    <div class="text-danger" style="margin-top: 8px; font-size: 1.1rem;">
                        {{ form.start_date.errors[0] }}
                    </div>
                    {% endif %}
                </div>
                <div class="date-field">
                    {{ form.end_date.label(class="form-label") }}
                    {{ form.end_date(class="form-control") }}
                    {% if form.end_date.errors %}
                    <div class="text-danger" style="margin-top: 8px; font-size: 1.1rem;">
                        {{ form.end_date.errors[0] }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Food Items Section -->
        <div class="form-section">
            <h3 class="section-title">
                <span>ü•ò</span> What will you eat?
            </h3>
            
            <div id="food-items">
                {% for item_form in form.items %}
                <div class="food-item">
                    <div class="food-item-number">{{ loop.index }}</div>
                    <div class="food-fields">
                        <div class="field-group">
                            <label class="form-label">
                                <span class="field-icon">üçΩÔ∏è</span>Food Name
                            </label>
                            {{ item_form.food_name(class="form-control", placeholder="e.g., Apple, Rice, Chicken") }}
                            {% if item_form.food_name.errors %}
                            <div class="text-danger" style="margin-top: 5px;">{{ item_form.food_name.errors[0] }}</div>
                            {% endif %}
                        </div>
                        <div class="field-group">
                            <label class="form-label">
                                <span class="field-icon">üî¢</span>Amount
                            </label>
                            {{ item_form.amount(class="form-control", step="0.01", placeholder="e.g., 1, 2.5") }}
                            {% if item_form.amount.errors %}
                            <div class="text-danger" style="margin-top: 5px;">{{ item_form.amount.errors[0] }}</div>
                            {% endif %}
                        </div>
                        <div class="field-group">
                            <label class="form-label">
                                <span class="field-icon">üìè</span>Unit
                            </label>
                            {{ item_form.unit(class="form-control") }}
                            {% if item_form.unit.errors %}
                            <div class="text-danger" style="margin-top: 5px;">{{ item_form.unit.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    <button type="button" class="btn btn-remove" onclick="removeItem(this)">
                        üóëÔ∏è Remove
                    </button>
                </div>
                {% endfor %}
            </div>
            
            <button type="button" class="btn btn-add-food" onclick="addFoodItem()">
                <span style="font-size: 1.5rem;">‚ûï</span> Add More Food
            </button>
        </div>

        <!-- Motivational Quote -->
        <div class="motivation-quote">
            üíö "Every healthy choice you make is an investment in your future wellbeing!"
        </div>

        <!-- Submit Section -->
        <div class="action-buttons">
            {{ form.submit(class="btn btn-submit", value="Save Food Entry üéâ") }}
            <div class="helper-text">
                <strong>Tip:</strong> Don't worry about being perfect! Any tracking is better than none. 
                You're doing great! üëè
            </div>
        </div>
    </form>
</div>

<script>
let itemIndex = {{ form.items|length }};

function addFoodItem() {
    const container = document.getElementById('food-items');
    const itemNumber = document.querySelectorAll('.food-item').length + 1;
    
    const newItem = document.createElement('div');
    newItem.className = 'food-item';
    newItem.style.animation = 'slideIn 0.3s ease-out';
    newItem.innerHTML = `
        <div class="food-item-number">${itemNumber}</div>
        <div class="food-fields">
            <div class="field-group">
                <label class="form-label">
                    <span class="field-icon">üçΩÔ∏è</span>Food Name
                </label>
                <input class="form-control" id="items-${itemIndex}-food_name" 
                       name="items-${itemIndex}-food_name" required type="text" 
                       placeholder="e.g., Apple, Rice, Chicken">
            </div>
            <div class="field-group">
                <label class="form-label">
                    <span class="field-icon">üî¢</span>Amount
                </label>
                <input class="form-control" id="items-${itemIndex}-amount" 
                       name="items-${itemIndex}-amount" required step="0.01" 
                       type="number" placeholder="e.g., 1, 2.5">
            </div>
            <div class="field-group">
                <label class="form-label">
                    <span class="field-icon">üìè</span>Unit
                </label>
                <select class="form-control" id="items-${itemIndex}-unit" 
                        name="items-${itemIndex}-unit" required>
                    <option value="">Choose unit...</option>
                    <option value="pieces">pieces</option>
                    <option value="g">grams (g)</option>
                    <option value="kg">kilograms (kg)</option>
                    <option value="ml">milliliters (ml)</option>
                    <option value="l">liters (l)</option>
                    <option value="tbsp">tablespoons</option>
                    <option value="tsp">teaspoons</option>
                    <option value="cups">cups</option>
                    <option value="bowls">bowls</option>
                    <option value="plates">plates</option>
                </select>
            </div>
        </div>
        <button type="button" class="btn btn-remove" onclick="removeItem(this)">
            üóëÔ∏è Remove
        </button>
    `;
    
    container.appendChild(newItem);
    itemIndex++;
    updateItemNumbers();
}

function removeItem(button) {
    const item = button.closest('.food-item');
    if (document.querySelectorAll('.food-item').length > 1) {
        item.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => {
            item.remove();
            updateItemNumbers();
        }, 300);
    } else {
        // More encouraging message
        alert('Keep at least one food item to track your meal! You\'re doing great! üòä');
    }
}

function updateItemNumbers() {
    const items = document.querySelectorAll('.food-item');
    items.forEach((item, index) => {
        const numberElement = item.querySelector('.food-item-number');
        if (numberElement) {
            numberElement.textContent = index + 1;
        }
    });
}

// Animation styles
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes slideOut {
        from {
            opacity: 1;
            transform: translateX(0);
        }
        to {
            opacity: 0;
            transform: translateX(-100%);
        }
    }
`;
document.head.appendChild(style);

// Add encouraging message on form submit
document.getElementById('food-form').addEventListener('submit', function(e) {
    // You could add a loading state here
    const submitBtn = document.querySelector('.btn-submit');
    submitBtn.textContent = 'Saving your healthy choices... üåü';
    submitBtn.disabled = true;
});
</script>

{% endblock %}