{% extends "layout.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
{% endblock %}

{% block content %}

<!-- Dashboard Header -->
<div class="dashboard-header">
    <h2>🌻 Your Wellness Dashboard</h2>
</div>

<!-- Weekly Report Section - ALWAYS VISIBLE -->
<div class="weekly-report-card" id="weeklyReportCard">
    <h3>📊 Your Weekly Report is Ready!</h3>
    <p>See your progress, patterns, and personalized insights from the past 7 days</p>
    <div class="text-center">
        <a href="{{ url_for('planting.weekly_report') }}" class="btn btn-warning btn-lg">
            View Weekly Report
        </a>
    </div>
    <div class="mt-3 text-center">
        <small style="color: #856404;">
            Updated every Monday morning
        </small>
    </div>
</div>

<!-- Daily Check-In Section -->
<div class="checkin-card">
    <h4>📝 Daily Check-In</h4>
    <p>Track your wellbeing in just 2 minutes</p>
    <a href="{{ url_for('planting.daily_checkin') }}" class="btn btn-info btn-lg">
        Start Today's Check-In
    </a>
</div>

<!-- Wellness Score -->
<div class="wellness-score-card">
    <h4>
        Wellness Score: 
        <span style="color: #4a7c59;">{{ wellness_score }}/200</span>
    </h4>
    <div class="progress">
        <div class="progress-bar" role="progressbar" 
             style="width: {{ (wellness_score/200)*100 }}%"
             aria-valuenow="{{ wellness_score }}" 
             aria-valuemin="0" 
             aria-valuemax="200">
            {{ wellness_score }} points
        </div>
    </div>
    <div class="mt-3">
        <small class="text-muted">
            {% if wellness_score < 50 %}
                Keep going! Every small step counts 🌱
            {% elif wellness_score < 100 %}
                Great progress! You're building momentum 🌿
            {% elif wellness_score < 150 %}
                Outstanding! You're a wellness champion 🏆
            {% else %}
                Outstanding! You're a wellness champion
            {% endif %}
        </small>
    </div>
</div>

<!-- Stats Grid -->
<div class="row">
    <div class="col-md-3 col-sm-6">
        <div class="stat-card">
            <h3>🌱</h3>
            <h5>{{ user.plant_count or 0 }}</h5>
            <p>Plants Grown</p>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="stat-card">
            <h3>🔥</h3>
            <h5>{{ user.streak or 0 }}</h5>
            <p>Day Streak</p>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="stat-card">
            <h3>🧘</h3>
            <h5>{{ user.mindfulness_streak or 0 }}</h5>
            <p>Mindful Days</p>
        </div>
    </div>
    <div class="col-md-3 col-sm-6">
        <div class="stat-card">
            <h3>⏱️</h3>
            <h5>{{ user.total_mindful_minutes or 0 }}</h5>
            <p>Total Minutes</p>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="quick-actions">
    <h4><i class="fas fa-rocket"></i> Quick Actions</h4>
    <div class="text-center">
        <a href="{{ url_for('planting.plant') }}" class="btn btn-success btn-lg">
            🌱 Plant & Breathe
        </a>
        <a href="{{ url_for('planting.all_vegetables') }}" class="btn btn-primary btn-lg">
            🎍 Effort Garden
        </a>
        <a href="{{ url_for('planting.unlock') }}" class="btn btn-info btn-lg">
            🛒 Unlock Vegetables
        </a>
        <a href="{{ url_for('planting.glory_hall') }}" class="btn btn-warning btn-lg">
            🏆 View Achievements
        </a>
    </div>
</div>

<!-- Recent Activity -->
<div class="row">
    <div class="col-md-6">
        <div class="activity-section">
            <h4>Recent Plants</h4>
            {% if recent_plants %}
                {% for plant in recent_plants %}
                <div class="activity-item plant">
                    <strong>{{ plant.name }}</strong> 
                    <span class="badge bg-success">{{ plant.type }}</span><br>
                    <small>
                        {{ plant.plant_time.strftime('%B %d at %I:%M %p') }}
                    </small>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-activity">
                    <p>No plants yet. Start your garden!</p>
                    <a href="{{ url_for('planting.plant') }}" class="btn btn-success">
                        Start Planting
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="activity-section">
            <h4>Recent Mindfulness</h4>
            {% if recent_mindfulness %}
                {% for log in recent_mindfulness %}
                <div class="activity-item mindfulness">
                    <strong>{{ log.activity_type|capitalize }}</strong>
                    <span class="badge bg-info">{{ log.duration_minutes }} min</span><br>
                    <small>
                        {{ log.date_completed.strftime('%B %d, %Y') }}
                    </small>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-activity">
                    <p>Start your mindfulness journey!</p>
                    <a href="{{ url_for('planting.daily_checkin') }}" class="btn btn-info">
                        Try Mindfulness
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script defer>
document.addEventListener('DOMContentLoaded', function() {
    const reportCard = document.getElementById('weeklyReportCard');
    
    // Check if the card exists
    if (!reportCard) {
        console.error('Weekly report card not found!');
        return;
    }
    
    // Make sure it's visible
    reportCard.style.display = 'block';
    reportCard.style.visibility = 'visible';
    reportCard.style.opacity = '1';
    
    // Delay non-critical operations
    setTimeout(() => {
        // Check if user has dismissed it (using localStorage)
        try {
            const dismissed = localStorage.getItem('weeklyReportDismissed');
            const today = new Date().toDateString();
            
            if (dismissed !== today) {
                // Show the report card prominently
                reportCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        } catch (error) {
            console.log('LocalStorage not available');
        }
        
        // Add animation after initial load
        reportCard.style.animation = 'pulse 2s infinite';
    }, 1000);
});
</script>

{% endblock %}