<!--weekly_report.html-->
{% extends "layout.html" %}
{% block content %}
<style>
    .report-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: white;
    }
    
    .report-header {
        background: linear-gradient(135deg, #4a7c59, #2c6f4f);
        color: white;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        margin-bottom: 30px;
    }
    
    .week-dates {
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 10px;
    }
    
    .report-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .stat-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }
    
    .stat-card {
        background: white;
        border: 2px solid #e8f5e9;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        transition: transform 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #2c6f4f;
    }
    
    .stat-label {
        font-size: 0.9rem;
        color: #666;
        margin-top: 5px;
    }
    
    .insight-card {
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        display: flex;
        align-items: flex-start;
    }
    
    .insight-card.success {
        background: #e8f5e9;
        border-left: 5px solid #4caf50;
    }
    
    .insight-card.warning {
        background: #fff3e0;
        border-left: 5px solid #ff9800;
    }
    
    .insight-card.info {
        background: #e3f2fd;
        border-left: 5px solid #2196f3;
    }
    
    .insight-icon {
        font-size: 2rem;
        margin-right: 15px;
    }
    
    .insight-content {
        flex: 1;
    }
    
    .insight-title {
        font-size: 1.3rem;
        font-weight: bold;
        margin-bottom: 5px;
        color: #333;
    }
    
    .insight-message {
        font-size: 1.1rem;
        color: #555;
        line-height: 1.6;
    }
    
    .mood-chart {
        background: white;
        border-radius: 15px;
        padding: 25px;
        margin: 30px 0;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .progress-ring {
        transform: rotate(-90deg);
    }
    
    .progress-ring-circle {
        stroke-dasharray: 408.4;
        stroke-dashoffset: 408.4;
        animation: progress 1s ease-out forwards;
    }
    
    @keyframes progress {
        to {
            stroke-dashoffset: var(--offset);
        }
    }
    
    .achievement-strip {
        display: flex;
        gap: 15px;
        padding: 20px;
        background: #fffacd;
        border-radius: 15px;
        overflow-x: auto;
        margin: 20px 0;
    }
    
    .achievement-badge {
        min-width: 100px;
        text-align: center;
        padding: 10px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .recommendation-card {
        background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
        border-radius: 15px;
        padding: 25px;
        margin: 30px 0;
    }
    
    .recommendation-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #2c6f4f;
        margin-bottom: 15px;
    }
    
    .recommendation-list {
        list-style: none;
        padding: 0;
    }
    
    .recommendation-list li {
        padding: 10px 0;
        font-size: 1.1rem;
        color: #333;
        border-bottom: 1px solid rgba(255,255,255,0.5);
    }
    
    .recommendation-list li:before {
        content: "→ ";
        color: #4a7c59;
        font-weight: bold;
        margin-right: 10px;
    }
    
    @media print {
        .no-print {
            display: none;
        }
        
        .report-container {
            max-width: 100%;
        }
    }
</style>

<div class="report-container">
    <!-- Header -->
     {% if stats %}
    <div class="report-header">
        {% if stats.best_day %}
        <div class="week-dates">
            {{ (stats.best_day - timedelta(days=6)).strftime('%B %d') }} - 
            {{ stats.best_day.strftime('%B %d, %Y') }}
        </div>
        {% endif %}
        <div class="report-title">Weekly Wellness Report</div>
        <div style="font-size: 1.1rem; margin-top: 10px;">
            For {{ current_user.username }}
        </div>
    </div>
    
    <!-- Quick Stats -->
    <div class="stat-grid">
        <div class="stat-card">
            <div class="stat-icon">🌱</div>
            <div class="stat-value">{{ stats.total_plants }}</div>
            <div class="stat-label">Plants Grown</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">📝</div>
            <div class="stat-value">{{ stats.total_checkins }}/7</div>
            <div class="stat-label">Daily Check-ins</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">🧘</div>
            <div class="stat-value">{{ stats.mindful_minutes }}</div>
            <div class="stat-label">Mindful Minutes</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">✨</div>
            <div class="stat-value">{{ "%.0f"|format(stats.self_care_score) }}%</div>
            <div class="stat-label">Self-Care Score</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">📊</div>
            <div class="stat-value">{{ "%.0f"|format(stats.consistency_score) }}%</div>
            <div class="stat-label">Consistency</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                {% if stats.avg_mood >= 4 %}😊
                {% elif stats.avg_mood >= 3 %}🙂
                {% elif stats.avg_mood >= 2 %}😐
                {% else %}😔{% endif %}
            </div>
            <div class="stat-value">{{ "%.1f"|format(stats.avg_mood) }}</div>
            <div class="stat-label">Avg Mood</div>
        </div>
    </div>
    
    <!-- Weekly Insights -->
    <h2 style="color: #2c6f4f; margin-top: 40px;">💡 Your Weekly Insights</h2>
    
    {% for insight in insights %}
    <div class="insight-card {{ insight.type }}">
        <div class="insight-icon">{{ insight.icon }}</div>
        <div class="insight-content">
            <div class="insight-title">{{ insight.title }}</div>
            <div class="insight-message">{{ insight.message }}</div>
        </div>
    </div>
    {% endfor %}
    
    <!-- Mood Trend Visualization -->
    {% if checkins %}
    <div class="mood-chart">
        <h3 style="color: #2c6f4f; margin-bottom: 20px;">📈 Week at a Glance</h3>
        
        <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 200px;">
            {% set days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] %}
            {% for day_num in range(7) %}
                {% set day_date = (stats.best_day - timedelta(days=6-day_num)) %}
                {% set day_checkin = checkins|selectattr('check_in_date', 'eq', day_date)|first %}
                
                <div style="display: flex; flex-direction: column; align-items: center; flex: 1;">
                    {% if day_checkin %}
                    <div style="background: #4a7c59; width: 40px; 
                                height: {{ (day_checkin.mood_rating * 40) }}px;
                                margin-bottom: 10px; border-radius: 5px 5px 0 0;
                                position: relative;">
                        <span style="position: absolute; top: -25px; left: 50%; 
                                   transform: translateX(-50%); font-size: 1.5rem;">
                            {% if day_checkin.mood_rating == 5 %}😊
                            {% elif day_checkin.mood_rating == 4 %}🙂
                            {% elif day_checkin.mood_rating == 3 %}😐
                            {% elif day_checkin.mood_rating == 2 %}😟
                            {% else %}😔{% endif %}
                        </span>
                    </div>
                    {% else %}
                    <div style="background: #e0e0e0; width: 40px; height: 20px;
                                margin-bottom: 10px; border-radius: 5px;">
                        <span style="position: absolute; top: -25px; left: 50%;
                                   transform: translateX(-50%);">-</span>
                    </div>
                    {% endif %}
                    <small>{{ days[day_num] }}</small>
                </div>
            {% endfor %}
        </div>
        
        {% if stats.best_day and stats.toughest_day %}
        <div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 10px;">
            <p><strong>Best Day:</strong> {{ stats.best_day.strftime('%A') }} 
               - Keep doing what worked this day!</p>
            <p><strong>Most Challenging:</strong> {{ stats.toughest_day.strftime('%A') }} 
               - Be extra kind to yourself on days like this.</p>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <!-- Weekly Achievements -->
    {% if achievements %}
    <h3 style="color: #2c6f4f; margin-top: 30px;">🏆 Achievements Unlocked</h3>
    <div class="achievement-strip">
        {% for achievement in achievements %}
        <div class="achievement-badge">
            <div style="font-size: 2rem;">🏅</div>
            <div style="font-weight: bold;">{{ achievement.name }}</div>
            <small>{{ achievement.date_earned.strftime('%m/%d') }}</small>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <!-- Personalized Recommendations -->
    <div class="recommendation-card">
        <div class="recommendation-title">📋 Recommendations for Next Week</div>
        <ul class="recommendation-list">
            {% if stats.avg_stress > 3.5 %}
            <li>Schedule 5-minute breathing breaks at 10am, 2pm, and 6pm daily</li>
            {% endif %}
            
            {% if stats.avg_sleep < 3 %}
            <li>Set a "wind-down" alarm 30 minutes before bedtime</li>
            {% endif %}
            
            {% if stats.self_care_score < 50 %}
            <li>Choose one self-care activity to prioritize each day</li>
            {% endif %}
            
            {% if stats.mindful_minutes < 20 %}
            <li>Try the 3-minute breathing exercise before bed</li>
            {% endif %}
            
            {% if stats.consistency_score < 70 %}
            <li>Set a daily reminder for your check-in at a consistent time</li>
            {% endif %}
            
            {% if stats.avg_mood < 3 %}
            <li>Connect with a friend or support group member this week</li>
            {% endif %}
            
            <li>Continue celebrating small victories - you're doing better than you think!</li>
        </ul>
    </div>
    
    <!-- Gratitude Highlights -->
    {% set gratitudes = checkins|selectattr('grateful_for')|list %}
    {% if gratitudes %}
    <div style="background: #fef5e7; border-radius: 15px; padding: 25px; margin: 30px 0;">
        <h3 style="color: #f39c12; margin-bottom: 15px;">🙏 Things You Were Grateful For</h3>
        {% for checkin in gratitudes %}
        <p style="font-size: 1.1rem; padding: 10px; background: white; 
                  border-radius: 10px; margin: 10px 0;">
            "{{ checkin.grateful_for }}" 
            <small style="color: #666;">- {{ checkin.check_in_date.strftime('%A') }}</small>
        </p>
        {% endfor %}
    </div>
    {% endif %}
    {% else %}
    <p>No data yet. Start to plant your first vegetable!</p>
    <a href="{{ url_for('planting.plant') }}" class="btn btn-primary btn-lg m-2">
    🌱 Plant & Breathe
</a>
{% endif %}
    
    <!-- Action Buttons -->
    <div style="text-align: center; margin-top: 40px;" class="no-print">
        <button onclick="window.print()" class="btn btn-secondary btn-lg">
            🖨️ Print Report
        </button>
        <a href="{{ url_for('planting.wellness_dashboard') }}" class="btn btn-primary btn-lg">
            📊 Dashboard
        </a>
    </div>
    
    <!-- Footer -->
    <div style="text-align: center; margin-top: 40px; padding: 20px; 
                background: #f5f5f5; border-radius: 15px;">
        <p style="font-size: 1.2rem; color: #2c6f4f; font-weight: bold;">
            Remember: Every small step matters
        </p>
        <p style="color: #666; margin-top: 10px;">
            This report is a reflection of your dedication to self-care. 
            Be proud of every effort you've made this week.
        </p>
    </div>
</div>
{% endblock %}